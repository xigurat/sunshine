// Generated by CoffeeScript 1.3.1
(function() {
  var ChangePasswordController,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor; child.__super__ = parent.prototype; return child; };

  ChangePasswordController = (function(_super) {

    __extends(ChangePasswordController, _super);

    ChangePasswordController.name = 'ChangePasswordController';

    function ChangePasswordController() {
      this.on_ok = __bind(this.on_ok, this);
      ChangePasswordController.__super__.constructor.apply(this, arguments);
      this.password_changed_ok = new Bootstrap.ModalMessage({
        el: $('#password-changed-successfully'),
        on_show_call: this.hide
      });
    }

    ChangePasswordController.prototype.on_ok = function() {
      var operation;
      operation = $.sajax('ajaxauth.change_password', {
        old_password: this.old_password.val(),
        new_password1: this.new_password1.val(),
        new_password2: this.new_password2.val()
      });
      if (operation.is_success) {
        this.password_changed_ok.show();
        return this.on_dismiss();
      } else {
        return this.el.showFormErrors(operation.errors);
      }
    };

    return ChangePasswordController;

  })(Bootstrap.Modal);

  $(function() {
    window.change_password_controller = new ChangePasswordController({
      el: $('#change-password-dialog')
    });
    return $('#logout').click(function(e) {
      e.preventDefault();
      $.sajax('ajaxauth.logout');
      return document.location.reload();
    });
  });

}).call(this);
