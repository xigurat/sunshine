// Generated by CoffeeScript 1.3.1
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor; child.__super__ = parent.prototype; return child; };

  Library.BookUploader = (function(_super) {

    __extends(BookUploader, _super);

    BookUploader.name = 'BookUploader';

    function BookUploader() {
      BookUploader.__super__.constructor.apply(this, arguments);
      this.qq_uploader = new qq.FileUploader({
        element: this.el[0],
        action: Library.Book.url,
        allowedExtensions: ['pdf'],
        maxConnections: 3,
        debug: true,
        template: '\
                <div class="qq-uploader">\
                    <div class="qq-upload-drop-area well centered">\
                        Drop files here to upload\
                    </div>\
                    <div class="row">\
                        <div class="qq-upload-button btn btn-primary pull-right">\
                            <i class="icon-upload icon-white"></i>\
                            Upload a file\
                        </div>\
                    </div>\
                    <ul class="qq-upload-list" style="list-style:none; margin: 10px 0;"></ul>\
                </div>\
            ',
        fileTemplate: '<li class="row">\
                <span class="span3 qq-upload-file"></span>\
                <span class="row">\
                    <span class=" qq-upload-spinner"></span>\
                    <span class="span3 qq-upload-size"></span>\
                    <span class="qq-upload-failed-text"></span>\
                </span>\
\
                <span class="row-fluid qq-upload-spinner">\
                    <div class="span1">&nbsp;</div>\
                    <div class="span9">\
                        <div class="progress">\
                            <div class="bar"></div>\
                        </div>\
                    </div>\
                    <span class="span2">\
                        <a class="btn btn-mini btn-danger qq-upload-cancel" href="#">Cancel</a>\
                    </span>\
                </span>\
\
                </li>\
            ',
        onProgress: function(id, file_name, loaded, total) {
          var $bar, percent;
          percent = loaded / total * 100;
          $bar = $('.bar', $('.qq-upload-list li')[id]);
          return $bar.css('width', "" + percent + "%");
        },
        onComplete: function(id, file_name, response) {
          $($('.qq-upload-list li')[id]).slideUp();
          return Library.Book.fetch($.query({
            id: response.id
          }));
        }
      });
    }

    return BookUploader;

  })(Spine.Controller);

  $(function() {
    return Library.book_uploader = new Library.BookUploader({
      el: $('#file-uploader')
    });
  });

}).call(this);
