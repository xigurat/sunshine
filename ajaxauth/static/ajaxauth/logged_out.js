// Generated by CoffeeScript 1.3.1
(function() {
  var LoginController, SignupController,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor; child.__super__ = parent.prototype; return child; };

  LoginController = (function(_super) {

    __extends(LoginController, _super);

    LoginController.name = 'LoginController';

    LoginController.prototype.elements = {
      '[name="username"]': 'username',
      '[name="password"]': 'password'
    };

    function LoginController() {
      this.on_ok = __bind(this.on_ok, this);
      LoginController.__super__.constructor.apply(this, arguments);
      this.login_error = new Bootstrap.ModalMessage({
        el: $('#login-error'),
        parent: this
      });
    }

    LoginController.prototype.on_ok = function() {
      var is_authenticated;
      is_authenticated = $.sajax('ajaxauth.login', {
        username: this.username.val(),
        password: this.password.val()
      });
      if (is_authenticated) {
        this.hide();
        return document.location.reload();
      } else {
        return this.login_error.show();
      }
    };

    return LoginController;

  })(Bootstrap.Modal);

  SignupController = (function(_super) {

    __extends(SignupController, _super);

    SignupController.name = 'SignupController';

    SignupController.prototype.elements = {
      '[name="username"]': 'username',
      '[name="first_name"]': 'first_name',
      '[name="last_name"]': 'last_name',
      '[name="email"]': 'email',
      '[name="password1"]': 'password1',
      '[name="password2"]': 'password2'
    };

    function SignupController() {
      this.on_ok = __bind(this.on_ok, this);
      SignupController.__super__.constructor.apply(this, arguments);
      this.ajax_error = new Bootstrap.ModalMessage({
        el: $('#ajax-error'),
        parent: this
      });
      this.signup_successful = new Bootstrap.ModalMessage({
        el: $('#signup-successful'),
        on_show_call: this.hide
      });
    }

    SignupController.prototype.on_ok = function() {
      var operation;
      try {
        operation = $.sajax('ajaxauth.signup', {
          username: this.username.val(),
          first_name: this.first_name.val(),
          last_name: this.last_name.val(),
          email: this.email.val(),
          password1: this.password1.val(),
          password2: this.password2.val()
        });
      } catch (error) {
        this.ajax_error.show();
        return;
      }
      if (operation.is_success) {
        this.log('si');
        this.signup_successful.show();
        return this.on_dismiss();
      } else {
        return this.el.showFormErrors(operation.errors);
      }
    };

    return SignupController;

  })(Bootstrap.Modal);

  $(function() {
    window.login_controller = new LoginController({
      el: $('#login-dialog')
    });
    return window.signup_controller = new SignupController({
      el: $('#signup-dialog')
    });
  });

}).call(this);
